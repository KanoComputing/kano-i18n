#!/usr/bin/env python
# coding:utf8
#
# fake-locale
#
# Copyright (C) 2016 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU GPL v2
#
# Generate a fake English-language locale file to
# test unicode support and UI variable sized text support
# We do this by translating all ascii English characters to unicode wide latin.

import polib
import sys
import os
import time

if __name__ == '__main__' and __package__ is None:
    os.sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from dev_locale.translate import trans_str  # noqa


tags = False

# Get command line arguments
if '-tags' in sys.argv:
    del sys.argv[sys.argv.index('-tags')]
    tags = True

if len(sys.argv) < 3:
    print "Usage: fake-locale messages.pot en_QQ.po"

inFile = sys.argv[1]
outFile = sys.argv[2]

# load input template
po = polib.pofile(inFile)
new = polib.POFile()

old_metadata = po.ordered_metadata()

# Construct metadata for new file
metadata = {
    'PO-Revision-Date': time.strftime("%Y-%M-%d %H:%m%z"),
    'Last-Translator': 'autogenerated',
    'Content-Type': 'text/plain; charset=UTF-8\n',
    'Language': 'en',
    'Language-Team': 'dev@kano.me'
}

# Override template values
for (mid, val) in old_metadata:
    if mid not in metadata:
        metadata[mid] = val

new.metadata = metadata

# Translate all entries
for entry in po:
    entry.msgstr = trans_str(entry.msgid, entry.flags, tags)
    new.append(entry)

new.save(outFile)
